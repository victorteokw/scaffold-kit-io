---
id: update-existing-file
title: Update existing file
---

In this section, let's create the command that creates a blog post. First,
let's generate a new command like before:

```bash
scaffold-kit command post
```

we want to create a file which name is based on the blog post name. Let's
update the generated command file `lib/commands/post/index.js`.

1. Require `kebabCase` at the top of the file.

```js
const kebabCase = require('lodash/kebabCase');
```

2. Add these line to the top of execution block.

```js
options.title = args[0] || 'Untitled Post';
options.filename = `${kebabCase(options.title)}.html`;
```

The usage of this command is almost the same with the `init` command we created
before. We convert the post name that user passes into kebab cased filename.

3. Update filename remapping to like this.

```js
const nameMap = {
  'post.html': options.filename
};
```

After updating the command execution, lets update the templates. Rename the
autogenerated template file to `_post.html` and alter its content.

```html
<html>
<head>
  <title><%= title %></title>
</head>
<body>
  <a href="./index.html">Back</a>
  <h1><%= title %></h1>
  <p>TODO: update blog content here</p>
</body>
</html>
```

Now try our blog scaffolding tool, open the autogenerated web page. Page title
shows and the back button works nicely. However, there are two problems:

1. In the title bar, the page shows post title but doesn't show blog name.
2. In the home page, there isn't a link that link to this post.

Let fix the problems one by one.

Add these into execution block.

```js
options.blogName = fs.readFileSync(path.join(wd, 'index.html'))
  .toString()
  .match(/<title>Home - (.*)<\/title>/)[1];
```

Also require `fs` module.

```js
const fs = require('fs');
```

Then replace this line in the template file.

```html
  <title><%= title %> - <%= blogName %></title>
```

Now we fixed title display problem. Let's update the post list now.

First insert `updateFile` into require block.

```js
const {
  // omitted...
  createFile,
  updateFile
} = require('scaffold-kit/executor');
```

Then append these at the end of execution block.

```js
updateFile({
  at: 'index.html',
  updator: (content) => {
    if (!content.match(new RegExp(options.title))) {
      return content.replace(
        / {2}<ul id="posts">(.*) {2}<\/ul>/ms,
        `  <ul id="posts">$1    <li><a href="./${options.filename}">\
${options.title}</a></li>\n  </ul>`
      );
    } else {
      return content;
    }
  },
  rollbacker: (content) => {
    return content.replace(
      new RegExp(`    <li><a href="./${options.filename}">\
${options.title}</a></li>\n`, 'm'),
      ''
    );
  }
});
```

`updateFile` is an execution instruction that updates the content of a file.
Basically it takes the filename, and return its new content in the updator.
Now let's create a new post with the following command:

```bash
blog post "Today's Post"
```

Now open `index.html` and navigate back and force. Isn't it a magic. If we try
to do this again, we see this:

```text
  up-to-date index.html
  up-to-date todays-post.html
```

This is the very smart behavior that we want an scaffolding tool to have.

Notice that there is a `rollbacker` in our code, we'll take the use of it in
the next section.
